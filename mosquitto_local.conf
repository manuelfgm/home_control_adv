# ==============================================
# CONFIGURACIÓN MOSQUITTO MQTT PARA RASPBERRY PI
# ==============================================

# Configuración básica local
listener 1883 0.0.0.0
protocol mqtt

# Configuración WebSocket (opcional, para cliente web)
listener 9001 0.0.0.0
protocol websockets

# Persistencia local
persistence true
persistence_location /var/lib/mosquitto/
autosave_interval 1800

# Logs
log_dest file /var/log/mosquitto/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true

# Conexiones
max_connections 50
max_inflight_messages 20
max_queued_messages 100

# Configuración de seguridad para red local
allow_anonymous true

# Para habilitar autenticación (recomendado), descomentar:
# allow_anonymous false
# password_file /etc/mosquitto/passwd

# Configuración de temas permitidos
# Permitir todos los temas en red local
topic readwrite #

# Configuración de keepalive
keepalive_interval 60

# Configuración de QoS máximo
max_qos 2

# Configuración de retained messages
retained_persistence true

# Configuración optimizada para Raspberry Pi
# Limitar memoria para dispositivos con recursos limitados
memory_limit 64MB

# Configuración de bridge (para conectar con otros brokers si es necesario)
# bridge_attempt_unsubscribe true
# bridge_notifications true

# Configuración específica para Home Control
# Logs de conexiones para debugging
connection_messages true
log_type subscribe
log_type unsubscribe

# Configuración de WebSockets para dashboard web
websockets_log_level 4

# Configuración de timeouts
retry_interval 20
message_size_limit 1024

# Configuración de cliente persistente
persistent_client_expiration 1h